const app=new Vue({el:"#app",data:{site_settings:{site_name:"Offico score"},timeframe:Date.now(),settings:{steam_id:"76561198020969037",matches_count:"35",hours_minus:14},endpoints:{last_matches:"https://aoe2.net/api/player/matches?game=aoe2de"},last_matches:[],score:{wins:0,losses:0,missing:!1,elo_change:0},is_loading:is_loading=!1,current_match:{active:!1,players:[]},periodic_check:{timer:!1,interval:6e4}},created(){this.get_url_info();const t=this.settings.hours_minus,e=new Date(this.timeframe);e.setHours(e.getHours()-t),this.timeframe=Date.parse(e),this.get_score(),this.start_periodic_check()},computed:{last_matches_url:function(){return`${this.endpoints.last_matches}&steam_id=${this.settings.steam_id}&count=${this.settings.matches_count}`}},methods:{get_url_info(){const t=new URL(window.location.href),e=new URLSearchParams(t.search),s=["steam_id","hours_minus","matches_count"];for(let t of s)e.has(t)&&(this.settings[t]=e.get(t))},convert_unix_to_date(t,e){let s=t;e&&(s=1e3*t);return new Date(s).toLocaleString()},async get_last_matches(){const t=await fetch(this.last_matches_url),e=await t.json();return this.last_matches=e,e},get_score(){this.get_last_matches().then(t=>{if(t.length<1)console.log("matches not found");else{for(let e=0;e<t.length;e++){const s=t[e],i=(s.started,1e3*s.finished),a=s.players;if(0!=i){if(!(i<this.timeframe))if(null!=a[0].won)for(let t=0;t<a.length;t++){const e=a[t];e.steam_id==this.settings.steam_id&&(this.score.elo_change+=e.rating_change,e.won?this.score.wins++:this.score.losses++)}else this.score.missing=!0}else this.current_match.active=!0,this.current_match.players=a}this.loading=!1}})},refresh_data(){this.loading||(this.loading=!0,this.score.wins=0,this.score.losses=0,this.score.elo_change=0,this.score.missing=!1,this.current_match.active=!1,this.get_score())},start_periodic_check(){this.periodic_check.timer||(this.periodic_check.timer=setInterval(()=>{this.refresh_data()},this.periodic_check.interval))},stop_periodic_check(){clearInterval(this.periodic_check.timer),this.periodic_check.timer=!1}}});