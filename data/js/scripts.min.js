const app=new Vue({el:"#app",components:{"date-picker":DatePicker},data:{site_settings:{site_name:"Offico score",site_url:"https://cdn.akamai.steamstatic.com/steamcommunity/public/images/avatars/4a/4a236972a7e48a22dba9c60397d106d9053249c4_full.jpg"},timeframe:Date.now(),settings:{steam_id:"76561198020969037",matches_count:"35",hours_from:14,scoreboard:!0},endpoints:{last_matches:"https://aoe2.net/api/player/matches?game=aoe2de"},last_matches:[],score:{wins:0,losses:0,missing:!1,elo_change:0},is_loading:is_loading=!1,current_match:{active:!1,players:[]},periodic_check:{timer:!1,interval:6e4}},created(){this.get_url_info();const t=this.settings.hours_from,e=new Date(this.timeframe);e.setHours(e.getHours()-t),this.timeframe=Date.parse(e),this.get_score(),this.start_periodic_check()},computed:{datetime:function(){return Date.now()},last_matches_url:function(){return`${this.endpoints.last_matches}&steam_id=${this.settings.steam_id}&count=${this.settings.matches_count}`}},methods:{get_url_info(){const t=new URL(window.location.href),e=new URLSearchParams(t.search);if(e.has("steam_id")){const t=e.get("steam_id");this.settings.steam_id=t}if(e.has("hours_from")){const t=e.get("hours_from");this.settings.hours_from=t}if(e.has("scoreboard")){const t=e.get("scoreboard");this.settings.scoreboard=t}},convert_unix_to_date(t,e){let s=t;e&&(s=1e3*t);return new Date(s).toLocaleString()},async get_last_matches(){const t=await fetch(this.last_matches_url),e=await t.json();return this.last_matches=e,e},get_score(){this.get_last_matches().then(t=>{if(t.length<1)console.log("matches not found");else{for(let e=0;e<t.length;e++){const s=t[e],i=(s.started,1e3*s.finished),a=s.players;if(0!=i){if(!(i<this.timeframe))if(null!=a[0].won)for(let t=0;t<a.length;t++){const e=a[t];e.steam_id==this.settings.steam_id&&(this.score.elo_change+=e.rating_change,e.won?this.score.wins++:this.score.losses++)}else this.score.missing=!0}else this.current_match.active=!0,this.current_match.players=a}this.loading=!1}})},refresh_data(){this.loading||(this.loading=!0,this.score.wins=0,this.score.losses=0,this.score.elo_change=0,this.score.missing=!1,this.current_match.active=!1,this.get_score())},start_periodic_check(){this.periodic_check.timer||(this.periodic_check.timer=setInterval(()=>{this.refresh_data()},this.periodic_check.interval))},stop_periodic_check(){clearInterval(this.periodic_check.timer),this.periodic_check.timer=!1},slide_toggle(t){"timeframe"==t&&document.querySelector(".timeframe.slide-toggle").classList.toggle("-active")}}});